<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>NewLifeRun Club - Panel Administrativo</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(
          135deg,
          #0f0f23 0%,
          #1a1a2e 50%,
          #16213e 100%
        );
        min-height: 100vh;
        color: #ffffff;
      }

      .admin-header {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(10px);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        padding: 1rem 2rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .logo-section {
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .logo {
        width: 50px;
        height: 50px;
        background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        color: white;
      }

      .admin-title {
        font-size: 1.5rem;
        font-weight: 700;
        background: linear-gradient(45deg, #667eea, #764ba2);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .logout-btn {
        background: linear-gradient(45deg, #ef4444, #dc2626);
        border: none;
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 500;
        transition: all 0.3s ease;
      }

      .logout-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(239, 68, 68, 0.3);
      }

      .main-container {
        display: grid;
        grid-template-columns: 250px 1fr;
        height: calc(100vh - 80px);
      }

      .sidebar {
        background: rgba(255, 255, 255, 0.03);
        border-right: 1px solid rgba(255, 255, 255, 0.1);
        padding: 2rem 1rem;
      }

      .nav-item {
        padding: 1rem;
        margin-bottom: 0.5rem;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }

      .nav-item:hover {
        background: rgba(102, 126, 234, 0.1);
      }

      .nav-item.active {
        background: linear-gradient(45deg, #667eea, #764ba2);
        color: white;
      }

      .content-area {
        padding: 2rem;
        overflow-y: auto;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
      }

      .stat-card {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        padding: 1.5rem;
        text-align: center;
        transition: transform 0.3s ease;
      }

      .stat-card:hover {
        transform: translateY(-5px);
      }

      .stat-number {
        font-size: 2rem;
        font-weight: 700;
        color: #667eea;
        margin-bottom: 0.5rem;
      }

      .stat-label {
        color: #a0a0a0;
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .section-title {
        font-size: 1.5rem;
        margin-bottom: 1rem;
        color: #ffffff;
      }

      .data-table {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 12px;
        overflow: hidden;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .table-header {
        background: rgba(102, 126, 234, 0.1);
        padding: 1rem;
        display: grid;
        grid-template-columns: 2fr 2fr 1fr 1fr 1fr 1fr;
        gap: 1rem;
        font-weight: 600;
      }

      .table-row {
        padding: 1rem;
        display: grid;
        grid-template-columns: 2fr 2fr 1fr 1fr 1fr 1fr;
        gap: 1rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        transition: background 0.3s ease;
      }

      .table-row:hover {
        background: rgba(255, 255, 255, 0.02);
      }

      .status-badge {
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 500;
        text-align: center;
      }

      .status-active {
        background: rgba(34, 197, 94, 0.2);
        color: #22c55e;
      }

      .status-pending {
        background: rgba(234, 179, 8, 0.2);
        color: #eab308;
      }

      .status-expired {
        background: rgba(239, 68, 68, 0.2);
        color: #ef4444;
      }

      .hidden {
        display: none;
      }

      .search-bar {
        margin-bottom: 1rem;
        padding: 0.75rem;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        color: white;
        width: 100%;
      }

      .search-bar::placeholder {
        color: #888;
      }

      .toggle-btn {
        padding: 0.5rem 1rem;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 500;
        font-size: 0.875rem;
        transition: all 0.3s ease;
      }

      .toggle-btn.activate {
        background: linear-gradient(45deg, #22c55e, #16a34a);
        color: white;
      }

      .toggle-btn.activate:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);
      }

      .toggle-btn.deactivate {
        background: linear-gradient(45deg, #ef4444, #dc2626);
        color: white;
      }

      .toggle-btn.deactivate:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
      }

      @media (max-width: 768px) {
        .main-container {
          grid-template-columns: 1fr;
        }

        .sidebar {
          display: none;
        }

        .stats-grid {
          grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        }

        .table-header,
        .table-row {
          grid-template-columns: 1fr;
          gap: 0.5rem;
        }
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <header class="admin-header">
      <div class="logo-section">
        <div class="logo">NL</div>
        <h1 class="admin-title">Panel Administrativo</h1>
      </div>
      <button class="logout-btn" onclick="logout()">Cerrar Sesi√≥n</button>
    </header>

    <!-- Main Container -->
    <div class="main-container">
      <!-- Sidebar -->
      <nav class="sidebar">
        <div
          class="nav-item active"
          onclick="showSection('dashboard')"
          id="nav-dashboard"
        >
          <span>üìä</span>
          <span>Dashboard</span>
        </div>
        <div class="nav-item" onclick="showSection('users')" id="nav-users">
          <span>üë•</span>
          <span>Usuarios</span>
        </div>
        <div
          class="nav-item"
          onclick="showSection('memberships')"
          id="nav-memberships"
        >
          <span>üí™</span>
          <span>Membres√≠as</span>
        </div>
        <div class="nav-item" onclick="showSection('orders')" id="nav-orders">
          <span>üõçÔ∏è</span>
          <span>Pedidos</span>
        </div>
        <div class="nav-item" onclick="showSection('plans')" id="nav-plans">
          <span>üèÉ‚Äç‚ôÇÔ∏è</span>
          <span>Planes</span>
        </div>
        <div class="nav-item" onclick="showSection('events')" id="nav-events">
          <span>üìÖ</span>
          <span>Eventos</span>
        </div>
        <div class="nav-item" onclick="showSection('routes')" id="nav-routes">
          <span>üó∫Ô∏è</span>
          <span>Rutas</span>
        </div>
        <div
          class="nav-item"
          onclick="showSection('contacts')"
          id="nav-contacts"
        >
          <span>üìß</span>
          <span>Contactos</span>
        </div>
      </nav>

      <!-- Content Area -->
      <main class="content-area">
        <!-- Dashboard Section -->
        <div id="dashboard-section" class="section">
          <h2 class="section-title">Dashboard General</h2>
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-number">1,247</div>
              <div class="stat-label">Usuarios Totales</div>
            </div>
            <div class="stat-card">
              <div class="stat-number">156</div>
              <div class="stat-label">Membres√≠as Activas</div>
            </div>
            <div class="stat-card">
              <div class="stat-number">2,890</div>
              <div class="stat-label">Ventas Totales</div>
            </div>
            <div class="stat-card">
              <div class="stat-number">89</div>
              <div class="stat-label">Planes Activos</div>
            </div>
            <div class="stat-card">
              <div class="stat-number">12</div>
              <div class="stat-label">Eventos Pendientes</div>
            </div>
            <div class="stat-card">
              <div class="stat-number">8</div>
              <div class="stat-label">Rutas Semanales</div>
            </div>
          </div>
        </div>

        <!-- Users Section -->
        <div id="users-section" class="section hidden">
          <h2 class="section-title">Gesti√≥n de Usuarios</h2>
          <input
            type="text"
            class="search-bar"
            placeholder="Buscar usuarios..."
            id="users-search"
          />
          <div class="data-table">
            <div class="table-header">
              <div>Nombre</div>
              <div>Email</div>
              <div>Tipo</div>
              <div>Fecha Registro</div>
              <div>Estado</div>
            </div>
            <div id="users-table-body">
              <!-- Se llenar√° din√°micamente -->
            </div>
          </div>
        </div>

        <!-- Memberships Section -->
        <div id="memberships-section" class="section hidden">
          <h2 class="section-title">Membres√≠as Activas</h2>
          <input
            type="text"
            class="search-bar"
            placeholder="Buscar membres√≠as..."
            id="memberships-search"
          />
          <div class="data-table">
            <div class="table-header">
              <div>Usuario</div>
              <div>Email</div>
              <div>Plan</div>
              <div>Estado</div>
              <div>Vence</div>
              <div>Acci√≥n</div>
            </div>
            <div id="memberships-table-body">
              <!-- Se llenar√° din√°micamente -->
            </div>
          </div>
        </div>

        <!-- Orders Section -->
        <div id="orders-section" class="section hidden">
          <h2 class="section-title">Pedidos de Tienda</h2>
          <input
            type="text"
            class="search-bar"
            placeholder="Buscar pedidos..."
            id="orders-search"
          />
          <div class="data-table">
            <div class="table-header">
              <div>Usuario</div>
              <div>Email</div>
              <div>Productos</div>
              <div>Total</div>
              <div>Estado</div>
            </div>
            <div id="orders-table-body">
              <!-- Se llenar√° din√°micamente -->
            </div>
          </div>
        </div>

        <!-- Plans Section -->
        <div id="plans-section" class="section hidden">
          <h2 class="section-title">Planes de Entrenamiento</h2>
          <input
            type="text"
            class="search-bar"
            placeholder="Buscar planes..."
            id="plans-search"
          />
          <div class="data-table">
            <div class="table-header">
              <div>Usuario</div>
              <div>Email</div>
              <div>Plan</div>
              <div>Estado</div>
              <div>Progreso</div>
            </div>
            <div id="plans-table-body">
              <!-- Se llenar√° din√°micamente -->
            </div>
          </div>
        </div>

        <!-- Events Section -->
        <div id="events-section" class="section hidden">
          <h2 class="section-title">Registros de Eventos</h2>
          <input
            type="text"
            class="search-bar"
            placeholder="Buscar eventos..."
            id="events-search"
          />
          <div class="data-table">
            <div class="table-header">
              <div>Participante</div>
              <div>Email</div>
              <div>Evento</div>
              <div>Fecha Evento</div>
              <div>Registrado</div>
            </div>
            <div id="events-table-body">
              <!-- Se llenar√° din√°micamente -->
            </div>
          </div>
        </div>

        <!-- Routes Section -->
        <div id="routes-section" class="section hidden">
          <h2 class="section-title">Registros de Rutas</h2>
          <input
            type="text"
            class="search-bar"
            placeholder="Buscar rutas..."
            id="routes-search"
          />
          <div class="data-table">
            <div class="table-header">
              <div>Participante</div>
              <div>Email</div>
              <div>Ruta</div>
              <div>D√≠a/Hora</div>
              <div>Registrado</div>
            </div>
            <div id="routes-table-body">
              <!-- Se llenar√° din√°micamente -->
            </div>
          </div>
        </div>

        <!-- Contacts Section -->
        <div id="contacts-section" class="section hidden">
          <h2 class="section-title">Mensajes de Contacto</h2>
          <input
            type="text"
            class="search-bar"
            placeholder="Buscar contactos..."
            id="contacts-search"
          />
          <div class="data-table">
            <div class="table-header">
              <div>Nombre</div>
              <div>Email</div>
              <div>Asunto</div>
              <div>Fecha</div>
              <div>Estado</div>
            </div>
            <div id="contacts-table-body">
              <!-- Se llenar√° din√°micamente -->
            </div>
          </div>
        </div>
      </main>
    </div>

    <script>
      // ========================================
      // üîó CONFIGURACI√ìN DE API PARA DATOS REALES DE NEON
      // ========================================
      const API_BASE_URL = "https://newlifeclub.onrender.com/api/admin";

      // Datos en tiempo real desde la base de datos Neon
      let realData = {
        users: [],
        dashboardStats: {},
      };

      // Funci√≥n para mostrar secciones
      function showSection(sectionName) {
        // Ocultar todas las secciones
        const sections = document.querySelectorAll(".section");
        sections.forEach((section) => section.classList.add("hidden"));

        // Remover clase active de todos los nav items
        const navItems = document.querySelectorAll(".nav-item");
        navItems.forEach((item) => item.classList.remove("active"));

        // Mostrar la secci√≥n seleccionada
        document
          .getElementById(sectionName + "-section")
          .classList.remove("hidden");
        document.getElementById("nav-" + sectionName).classList.add("active");

        // Cargar datos de la secci√≥n
        loadSectionData(sectionName);
      }

      // ========================================
      // üìä CARGAR ESTAD√çSTICAS DEL DASHBOARD (DATOS REALES)
      // ========================================
      async function loadDashboardStats() {
        try {
          console.log("üîÑ Cargando estad√≠sticas del dashboard...");
          const response = await fetch(`${API_BASE_URL}/dashboard-stats`);
          const data = await response.json();

          if (!response.ok) {
            throw new Error(data.message || "Error al cargar estad√≠sticas");
          }

          console.log("‚úÖ Estad√≠sticas cargadas:", data);
          realData.dashboardStats = data.stats;

          // Actualizar las estad√≠sticas en el dashboard
          updateDashboardUI(data.stats);
        } catch (error) {
          console.error("‚ùå Error cargando estad√≠sticas:", error);
        }
      }

      // Actualizar interfaz del dashboard
      function updateDashboardUI(stats) {
        const statsGrid = document.querySelector(".stats-grid");
        statsGrid.innerHTML = `
          <div class="stat-card">
            <div class="stat-number">${stats.totalUsers}</div>
            <div class="stat-label">Usuarios Totales</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">${stats.activeMemberships}</div>
            <div class="stat-label">Membres√≠as Activas</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">${stats.totalSales}</div>
            <div class="stat-label">Ventas Totales</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">${stats.activeTrainingPlans}</div>
            <div class="stat-label">Planes Activos</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">${stats.pendingEvents}</div>
            <div class="stat-label">Eventos Pendientes</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">L.${
              stats.totalRevenue?.toFixed(2) || "0.00"
            }</div>
            <div class="stat-label">Ingresos Totales</div>
          </div>
        `;
      }

      // ========================================
      // üë• CARGAR USUARIOS REALES DESDE NEON
      // ========================================
      async function loadUsers() {
        const tableBody = document.getElementById("users-table-body");

        try {
          console.log("üîÑ Cargando usuarios reales desde Neon...");
          const response = await fetch(`${API_BASE_URL}/users`);
          const data = await response.json();

          if (!response.ok) {
            throw new Error(data.message || "Error al cargar usuarios");
          }

          console.log("‚úÖ Usuarios cargados:", data);
          realData.users = data.users;

          // Limpiar tabla
          tableBody.innerHTML = "";

          if (data.users.length === 0) {
            tableBody.innerHTML = `
              <div style="padding: 2rem; text-align: center; color: #888; grid-column: 1 / -1;">
                üìã No hay usuarios registrados a√∫n.<br>
                <small>Los usuarios aparecer√°n aqu√≠ cuando se registren en el sitio web.</small>
              </div>
            `;
          } else {
            // Mostrar usuarios reales
            data.users.forEach((user) => {
              const row = document.createElement("div");
              row.className = "table-row";
              row.innerHTML = `
                <div>${user.name}</div>
                <div>${user.email}</div>
                <div>${user.type}</div>
                <div>${user.joinDate}</div>
                <div><span class="status-badge status-active">${user.status}</span></div>
              `;
              tableBody.appendChild(row);
            });
          }
        } catch (error) {
          console.error("‚ùå Error cargando usuarios:", error);
          tableBody.innerHTML = `
            <div style="padding: 2rem; text-align: center; color: #ef4444; grid-column: 1 / -1;">
              ‚ùå Error al cargar usuarios: ${error.message}<br>
              <small>Verifica la conexi√≥n con la base de datos.</small>
            </div>
          `;
        }
      }

      // ========================================
      // üí™ CARGAR MEMBRES√çAS REALES DESDE NEON
      // ========================================
      async function loadMemberships() {
        const tableBody = document.getElementById("memberships-table-body");

        try {
          console.log("üîÑ Cargando membres√≠as reales desde Neon...");
          const response = await fetch(`${API_BASE_URL}/memberships`);
          const data = await response.json();

          if (!response.ok) {
            throw new Error(data.message || "Error al cargar membres√≠as");
          }

          console.log("‚úÖ Membres√≠as cargadas:", data);

          // Limpiar tabla
          tableBody.innerHTML = "";

          if (data.memberships.length === 0) {
            tableBody.innerHTML = `
              <div style="padding: 2rem; text-align: center; color: #888; grid-column: 1 / -1;">
                üìã No hay membres√≠as registradas a√∫n.<br>
                <small>Las membres√≠as aparecer√°n aqu√≠ cuando los usuarios las compren.</small>
              </div>
            `;
          } else {
            // Mostrar membres√≠as reales
            data.memberships.forEach((membership) => {
              const row = document.createElement("div");
              row.className = "table-row";

              const statusClass =
                membership.status === "activa"
                  ? "status-active"
                  : "status-expired";
              const statusText =
                membership.status === "activa" ? "Activa" : "Inactiva";

              row.innerHTML = `
                <div>${membership.user}</div>
                <div>${membership.email}</div>
                <div>${membership.plan}</div>
                <div><span class="status-badge ${statusClass}">${statusText}</span></div>
                <div>${membership.expiresAt}</div>
                <div>
                  <button 
                    onclick="toggleMembership(${membership.id}, '${
                membership.status === "activa" ? "deactivate" : "activate"
              }')"
                    class="toggle-btn ${
                      membership.status === "activa" ? "deactivate" : "activate"
                    }"
                  >
                    ${
                      membership.status === "activa"
                        ? "‚ùå Desactivar"
                        : "‚úÖ Activar"
                    }
                  </button>
                </div>
              `;
              tableBody.appendChild(row);
            });
          }
        } catch (error) {
          console.error("‚ùå Error cargando membres√≠as:", error);
          tableBody.innerHTML = `
            <div style="padding: 2rem; text-align: center; color: #ef4444; grid-column: 1 / -1;">
              ‚ùå Error al cargar membres√≠as: ${error.message}<br>
              <small>Verifica la conexi√≥n con la base de datos.</small>
            </div>
          `;
        }
      }

      // ========================================
      // üîÑ ACTIVAR/DESACTIVAR MEMBRES√çA
      // ========================================
      async function toggleMembership(id, action) {
        try {
          const actionText = action === "activate" ? "activar" : "desactivar";

          if (
            !confirm(
              `¬øEst√°s seguro de que quieres ${actionText} esta membres√≠a?`
            )
          ) {
            return;
          }

          const response = await fetch(
            `${API_BASE_URL}/memberships/${id}/toggle`,
            {
              method: "PUT",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ action: action }),
            }
          );

          const data = await response.json();

          if (!response.ok) {
            throw new Error(data.message || `Error al ${actionText} membres√≠a`);
          }

          console.log(`‚úÖ Membres√≠a ${actionText}da:`, data);

          // Recargar membres√≠as para mostrar el cambio
          loadMemberships();

          // Mostrar mensaje de √©xito (opcional)
          alert(`‚úÖ Membres√≠a ${actionText}da exitosamente`);
        } catch (error) {
          console.error(
            `‚ùå Error al ${
              action === "activate" ? "activar" : "desactivar"
            } membres√≠a:`,
            error
          );
          alert(`‚ùå Error: ${error.message}`);
        }
      }

      // Funci√≥n para cargar datos de cada secci√≥n
      function loadSectionData(sectionName) {
        switch (sectionName) {
          case "dashboard":
            loadDashboardStats();
            break;
          case "users":
            loadUsers();
            break;
          case "memberships":
            loadMemberships();
            break;
          default:
            // Para otras secciones, mostrar mensaje de "pr√≥ximamente"
            const tableBody = document.getElementById(
              sectionName + "-table-body"
            );
            if (tableBody) {
              tableBody.innerHTML = `
                <div style="padding: 2rem; text-align: center; color: #888; grid-column: 1 / -1;">
                  üöß Secci√≥n en desarrollo<br>
                  <small>Esta funcionalidad estar√° disponible pronto.</small>
                </div>
              `;
            }
            break;
        }
      }

      // Funci√≥n de logout
      function logout() {
        if (confirm("¬øEst√°s seguro de que quieres cerrar sesi√≥n?")) {
          // Limpiar sesiones
          localStorage.removeItem("adminSession");
          sessionStorage.removeItem("adminSession");
          window.location.href = "adminlogin.html";
        }
      }

      // Verificar sesi√≥n de administrador
      function checkAdminSession() {
        const sessionActive =
          localStorage.getItem("adminSession") ||
          sessionStorage.getItem("adminSession");
        if (!sessionActive) {
          alert("Acceso denegado. Debes iniciar sesi√≥n como administrador.");
          window.location.href = "adminlogin.html";
          return false;
        }
        return true;
      }

      // Cargar dashboard por defecto
      document.addEventListener("DOMContentLoaded", function () {
        if (checkAdminSession()) {
          showSection("dashboard");
        }
      });

      // ========================================
      // üîç B√öSQUEDA EN TIEMPO REAL PARA USUARIOS
      // ========================================
      document.addEventListener("DOMContentLoaded", function () {
        const searchInput = document.getElementById("users-search");
        if (searchInput) {
          searchInput.addEventListener("input", function (e) {
            const searchTerm = e.target.value.toLowerCase();
            filterUsersTable(searchTerm);
          });
        }
      });

      function filterUsersTable(searchTerm) {
        const tableBody = document.getElementById("users-table-body");
        const rows = tableBody.querySelectorAll(".table-row");

        rows.forEach((row) => {
          const text = row.textContent.toLowerCase();
          if (text.includes(searchTerm)) {
            row.style.display = "";
          } else {
            row.style.display = "none";
          }
        });
      }
    </script>
  </body>
</html>
