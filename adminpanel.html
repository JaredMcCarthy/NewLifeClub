<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>NewLifeRun Club - Panel Administrativo</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(
          135deg,
          #0f0f23 0%,
          #1a1a2e 50%,
          #16213e 100%
        );
        min-height: 100vh;
        color: #ffffff;
      }

      .admin-header {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(10px);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        padding: 1rem 2rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .logo-section {
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .logo {
        width: 50px;
        height: 50px;
        background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        color: white;
      }

      .admin-title {
        font-size: 1.5rem;
        font-weight: 700;
        background: linear-gradient(45deg, #667eea, #764ba2);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .logout-btn {
        background: linear-gradient(45deg, #ef4444, #dc2626);
        border: none;
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 500;
        transition: all 0.3s ease;
      }

      .logout-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(239, 68, 68, 0.3);
      }

      .main-container {
        display: grid;
        grid-template-columns: 250px 1fr;
        height: calc(100vh - 80px);
      }

      .sidebar {
        background: rgba(255, 255, 255, 0.03);
        border-right: 1px solid rgba(255, 255, 255, 0.1);
        padding: 2rem 1rem;
      }

      .nav-item {
        padding: 1rem;
        margin-bottom: 0.5rem;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }

      .nav-item:hover {
        background: rgba(102, 126, 234, 0.1);
      }

      .nav-item.active {
        background: linear-gradient(45deg, #667eea, #764ba2);
        color: white;
      }

      .content-area {
        padding: 2rem;
        overflow-y: auto;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
      }

      .stat-card {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        padding: 1.5rem;
        text-align: center;
        transition: transform 0.3s ease;
      }

      .stat-card:hover {
        transform: translateY(-5px);
      }

      .stat-number {
        font-size: 2rem;
        font-weight: 700;
        color: #667eea;
        margin-bottom: 0.5rem;
      }

      .stat-label {
        color: #a0a0a0;
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .section-title {
        font-size: 1.5rem;
        margin-bottom: 1rem;
        color: #ffffff;
      }

      .data-table {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 12px;
        overflow: hidden;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .table-header {
        background: rgba(102, 126, 234, 0.1);
        padding: 1rem;
        display: grid;
        grid-template-columns: 2fr 2fr 1fr 1fr 1fr 1fr;
        gap: 1rem;
        font-weight: 600;
      }

      .table-row {
        padding: 1rem;
        display: grid;
        grid-template-columns: 2fr 2fr 1fr 1fr 1fr 1fr;
        gap: 1rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        transition: background 0.3s ease;
      }

      .table-row.orders-row {
        grid-template-columns: 1.2fr 1.8fr 2.5fr 0.8fr 1.5fr 1fr 1fr 1fr 1fr 1.5fr;
        gap: 0.5rem;
        font-size: 0.875rem;
        min-height: 80px;
        align-items: center;
      }

      .products-cell {
        max-height: 60px;
        overflow-y: auto;
        padding: 0.5rem;
        background: rgba(255, 255, 255, 0.02);
        border-radius: 4px;
        font-size: 0.8rem;
        line-height: 1.3;
      }

      .products-cell::-webkit-scrollbar {
        width: 4px;
      }

      .products-cell::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 2px;
      }

      .products-cell::-webkit-scrollbar-thumb {
        background: rgba(102, 126, 234, 0.5);
        border-radius: 2px;
      }

      .table-row:hover {
        background: rgba(255, 255, 255, 0.02);
      }

      .status-badge {
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 500;
        text-align: center;
      }

      .status-active {
        background: rgba(34, 197, 94, 0.2);
        color: #22c55e;
      }

      .status-pending {
        background: rgba(234, 179, 8, 0.2);
        color: #eab308;
      }

      .status-expired {
        background: rgba(239, 68, 68, 0.2);
        color: #ef4444;
      }

      .hidden {
        display: none;
      }

      .search-bar {
        margin-bottom: 1rem;
        padding: 0.75rem;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        color: white;
        width: 100%;
      }

      .search-bar::placeholder {
        color: #888;
      }

      .toggle-btn {
        padding: 0.5rem 1rem;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 500;
        font-size: 0.875rem;
        transition: all 0.3s ease;
      }

      .toggle-btn.activate {
        background: linear-gradient(45deg, #22c55e, #16a34a);
        color: white;
      }

      .toggle-btn.activate:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);
      }

      .toggle-btn.deactivate {
        background: linear-gradient(45deg, #ef4444, #dc2626);
        color: white;
      }

      .toggle-btn.deactivate:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
      }

      /* ============================================ */
      /* 🎨 ESTILOS DE POP-UPS DE CONFIRMACIÓN MEJORADOS */
      /* ============================================ */
      .popup-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(
          135deg,
          rgba(0, 0, 0, 0.8),
          rgba(16, 20, 30, 0.9)
        );
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        animation: popupFadeIn 0.4s ease-out;
      }

      .popup-overlay.show {
        opacity: 1;
        visibility: visible;
      }

      .popup-content {
        background: linear-gradient(
          145deg,
          #1a1a2e 0%,
          #16213e 50%,
          #0d1117 100%
        );
        border: 2px solid rgba(255, 255, 255, 0.15);
        border-radius: 24px;
        padding: 2.5rem;
        max-width: 450px;
        width: 92%;
        text-align: center;
        position: relative;
        box-shadow: 0 25px 60px rgba(0, 0, 0, 0.4),
          0 15px 30px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.1);
        transform: scale(0.7) rotateX(45deg);
        transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        transform-style: preserve-3d;
        perspective: 1000px;
      }

      .popup-overlay.show .popup-content {
        transform: scale(1) rotateX(0deg);
      }

      /* Efecto de brillo animado en el borde */
      .popup-content::before {
        content: "";
        position: absolute;
        top: -2px;
        left: -2px;
        right: -2px;
        bottom: -2px;
        background: linear-gradient(
          45deg,
          transparent,
          rgba(34, 197, 94, 0.3),
          transparent,
          rgba(59, 130, 246, 0.3),
          transparent
        );
        border-radius: 24px;
        z-index: -1;
        animation: borderGlow 3s linear infinite;
      }

      @keyframes borderGlow {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      @keyframes popupFadeIn {
        0% {
          opacity: 0;
          backdrop-filter: blur(0px);
        }
        100% {
          opacity: 1;
          backdrop-filter: blur(10px);
        }
      }

      .popup-icon {
        font-size: 4rem;
        margin-bottom: 1.2rem;
        display: inline-block;
        animation: iconBounce 0.6s ease-out 0.2s both;
        filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
      }

      @keyframes iconBounce {
        0% {
          transform: scale(0) rotate(-180deg);
          opacity: 0;
        }
        50% {
          transform: scale(1.2) rotate(-90deg);
        }
        100% {
          transform: scale(1) rotate(0deg);
          opacity: 1;
        }
      }

      .popup-title {
        font-size: 1.8rem;
        font-weight: 800;
        margin-bottom: 1.2rem;
        color: #ffffff;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        animation: titleSlideIn 0.5s ease-out 0.3s both;
        background: linear-gradient(135deg, #ffffff, #e0e7ff);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      @keyframes titleSlideIn {
        0% {
          transform: translateY(-20px);
          opacity: 0;
        }
        100% {
          transform: translateY(0);
          opacity: 1;
        }
      }

      .popup-message {
        color: #cbd5e1;
        margin-bottom: 2.5rem;
        line-height: 1.6;
        font-size: 1.1rem;
        animation: messageSlideIn 0.5s ease-out 0.4s both;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
      }

      @keyframes messageSlideIn {
        0% {
          transform: translateY(20px);
          opacity: 0;
        }
        100% {
          transform: translateY(0);
          opacity: 1;
        }
      }

      .popup-buttons {
        display: flex;
        gap: 1.2rem;
        justify-content: center;
        animation: buttonsSlideUp 0.5s ease-out 0.5s both;
      }

      @keyframes buttonsSlideUp {
        0% {
          transform: translateY(30px);
          opacity: 0;
        }
        100% {
          transform: translateY(0);
          opacity: 1;
        }
      }

      .popup-btn {
        padding: 1rem 2rem;
        border: none;
        border-radius: 12px;
        font-weight: 700;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        min-width: 120px;
        position: relative;
        overflow: hidden;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      }

      .popup-btn::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.2),
          transparent
        );
        transition: left 0.5s;
      }

      .popup-btn:hover::before {
        left: 100%;
      }

      .popup-btn.confirm {
        background: linear-gradient(135deg, #22c55e, #16a34a, #15803d);
        color: white;
        border: 1px solid rgba(34, 197, 94, 0.3);
      }

      .popup-btn.confirm:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(34, 197, 94, 0.4),
          0 4px 10px rgba(0, 0, 0, 0.3);
        background: linear-gradient(135deg, #16a34a, #15803d, #166534);
      }

      .popup-btn.confirm:active {
        transform: translateY(-1px);
      }

      .popup-btn.cancel {
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.1),
          rgba(255, 255, 255, 0.05)
        );
        color: #ffffff;
        border: 2px solid rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(5px);
      }

      .popup-btn.cancel:hover {
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.2),
          rgba(255, 255, 255, 0.1)
        );
        border-color: rgba(255, 255, 255, 0.4);
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(255, 255, 255, 0.1),
          0 4px 10px rgba(0, 0, 0, 0.3);
      }

      .popup-btn.cancel:active {
        transform: translateY(-1px);
      }

      .popup-btn.danger {
        background: linear-gradient(135deg, #ef4444, #dc2626, #b91c1c);
        color: white;
        border: 1px solid rgba(239, 68, 68, 0.3);
      }

      .popup-btn.danger:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(239, 68, 68, 0.4),
          0 4px 10px rgba(0, 0, 0, 0.3);
        background: linear-gradient(135deg, #dc2626, #b91c1c, #991b1b);
      }

      .popup-btn.danger:active {
        transform: translateY(-1px);
      }

      /* Efecto de partículas flotantes */
      .popup-content::after {
        content: "✨";
        position: absolute;
        top: 15px;
        right: 20px;
        font-size: 1.2rem;
        opacity: 0.6;
        animation: float 3s ease-in-out infinite;
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0px);
          opacity: 0.6;
        }
        50% {
          transform: translateY(-10px);
          opacity: 1;
        }
      }

      /* ============================================ */
      /* 📱 DISEÑO RESPONSIVE PARA MÓVILES */
      /* ============================================ */
      @media (max-width: 768px) {
        /* 📲 HEADER MÓVIL */
        .admin-header {
          padding: 0.8rem 1rem;
          flex-direction: column;
          gap: 0.5rem;
        }

        .admin-title {
          font-size: 1.3rem;
          margin: 0;
        }

        .logo {
          width: 35px;
          height: 35px;
          font-size: 1rem;
        }

        .logout-btn {
          padding: 0.6rem 1.2rem;
          font-size: 0.9rem;
        }

        /* 🏗️ LAYOUT PRINCIPAL MÓVIL */
        .main-container {
          grid-template-columns: 1fr;
          padding: 0;
          gap: 0;
        }

        /* 📱 MENÚ DESPLEGABLE MÓVIL */
        .sidebar {
          display: block;
          position: fixed;
          top: 140px; /* Después del header */
          left: 0;
          right: 0;
          background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
          border-radius: 0;
          padding: 0;
          box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
          z-index: 100;
          max-height: 0;
          overflow: hidden;
          transition: max-height 0.3s ease;
        }

        .sidebar.mobile-open {
          max-height: 400px;
        }

        .nav-item {
          padding: 1rem;
          border-bottom: 1px solid rgba(255, 255, 255, 0.1);
          font-size: 0.95rem;
        }

        .nav-item:last-child {
          border-bottom: none;
        }

        /* 📱 BOTÓN HAMBURGUESA */
        .mobile-menu-btn {
          display: block;
          position: fixed;
          top: 20px;
          right: 20px;
          background: linear-gradient(45deg, #667eea, #764ba2);
          border: none;
          border-radius: 8px;
          color: white;
          font-size: 1.2rem;
          padding: 0.8rem;
          cursor: pointer;
          z-index: 101;
          box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
          transition: all 0.3s ease;
        }

        .mobile-menu-btn:hover {
          transform: scale(1.05);
          box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        /* 📊 ÁREA DE CONTENIDO MÓVIL */
        .content-area {
          padding: 1rem;
          margin-top: 140px; /* Espacio para header fijo */
        }

        .section-title {
          font-size: 1.4rem;
          margin-bottom: 1rem;
          text-align: center;
        }

        /* 📊 TARJETAS DEL DASHBOARD MÓVIL */
        .stats-grid {
          grid-template-columns: repeat(2, 1fr);
          gap: 0.8rem;
          margin-bottom: 1.5rem;
        }

        .stat-card {
          padding: 1rem;
          min-height: auto;
        }

        .stat-number {
          font-size: 1.5rem;
          margin-bottom: 0.3rem;
        }

        .stat-label {
          font-size: 0.75rem;
          line-height: 1.2;
          text-align: center;
        }

        /* 🔍 BARRA DE BÚSQUEDA MÓVIL */
        .search-bar {
          font-size: 0.9rem;
          padding: 0.8rem;
          margin-bottom: 1rem;
        }

        /* 📋 TABLAS RESPONSIVE */
        .data-table {
          overflow-x: auto;
          -webkit-overflow-scrolling: touch;
        }

        .table-header {
          display: none; /* Ocultar headers en móvil */
        }

        .table-row {
          display: block;
          background: rgba(255, 255, 255, 0.05);
          border: 1px solid rgba(255, 255, 255, 0.1);
          border-radius: 8px;
          padding: 1rem;
          margin-bottom: 0.8rem;
          position: relative;
        }

        .table-row > div {
          display: block;
          padding: 0.3rem 0;
          border-bottom: 1px solid rgba(255, 255, 255, 0.1);
          position: relative;
          padding-left: 100px;
        }

        .table-row > div:last-child {
          border-bottom: none;
        }

        /* Labels para cada campo en móvil */
        .table-row > div:before {
          content: attr(data-label);
          position: absolute;
          left: 0;
          top: 0.3rem;
          font-weight: 600;
          color: #3b82f6;
          font-size: 0.8rem;
          width: 90px;
        }

        /* 🎨 POPUPS MÓVIL */
        .popup-content {
          margin: 1rem;
          padding: 1.5rem;
          max-width: 90%;
          width: auto;
        }

        .popup-title {
          font-size: 1.4rem;
        }

        .popup-message {
          font-size: 1rem;
          margin-bottom: 1.5rem;
        }

        .popup-buttons {
          flex-direction: column;
          gap: 0.8rem;
        }

        .popup-btn {
          width: 100%;
          padding: 0.8rem;
          font-size: 0.9rem;
        }

        /* 🔘 BOTONES Y CONTROLES MÓVIL */
        .toggle-btn {
          padding: 0.4rem 0.8rem;
          font-size: 0.8rem;
        }

        select {
          padding: 0.5rem !important;
          font-size: 0.85rem !important;
        }

        /* 📱 UTILIDADES MÓVIL */
        .mobile-only {
          display: block !important;
        }

        .desktop-only {
          display: none !important;
        }

        /* 📊 AJUSTES ESPECÍFICOS PARA DASHBOARD */
        #dashboard-section .stats-grid {
          grid-template-columns: 1fr;
          gap: 0.6rem;
        }

        #dashboard-section .stat-card {
          display: flex;
          align-items: center;
          gap: 1rem;
          padding: 0.8rem;
          text-align: left;
        }

        #dashboard-section .stat-number {
          font-size: 1.8rem;
          margin: 0;
          min-width: 80px;
        }

        #dashboard-section .stat-label {
          font-size: 0.85rem;
          text-align: left;
          line-height: 1.3;
        }
      }

      /* 🎯 ESTILOS ESPECÍFICOS SOLO PARA DESKTOP */
      @media (min-width: 769px) {
        .mobile-menu-btn {
          display: none;
        }

        .mobile-only {
          display: none !important;
        }
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <header class="admin-header">
      <div class="logo-section">
        <div class="logo">NL</div>
        <h1 class="admin-title">Panel Administrativo</h1>
      </div>
      <button class="logout-btn" onclick="logout()">Cerrar Sesión</button>
    </header>

    <!-- 📱 Botón Menú Móvil -->
    <button class="mobile-menu-btn" onclick="toggleMobileMenu()">
      <span id="menu-icon">☰</span>
    </button>

    <!-- Main Container -->
    <div class="main-container">
      <!-- Sidebar -->
      <nav class="sidebar">
        <div
          class="nav-item active"
          onclick="showSection('dashboard')"
          id="nav-dashboard"
        >
          <span>📊</span>
          <span>Dashboard</span>
        </div>
        <div class="nav-item" onclick="showSection('users')" id="nav-users">
          <span>👥</span>
          <span>Usuarios</span>
        </div>
        <div
          class="nav-item"
          onclick="showSection('memberships')"
          id="nav-memberships"
        >
          <span>💪</span>
          <span>Membresías</span>
        </div>
        <div class="nav-item" onclick="showSection('orders')" id="nav-orders">
          <span>🛍️</span>
          <span>Pedidos</span>
        </div>
        <div class="nav-item" onclick="showSection('plans')" id="nav-plans">
          <span>🏃‍♂️</span>
          <span>Planes</span>
        </div>
        <div class="nav-item" onclick="showSection('events')" id="nav-events">
          <span>📅</span>
          <span>Eventos</span>
        </div>
        <div class="nav-item" onclick="showSection('routes')" id="nav-routes">
          <span>🗺️</span>
          <span>Rutas</span>
        </div>
        <div
          class="nav-item"
          onclick="showSection('contacts')"
          id="nav-contacts"
        >
          <span>📧</span>
          <span>Contactos</span>
        </div>
      </nav>

      <!-- Content Area -->
      <main class="content-area">
        <!-- Dashboard Section -->
        <div id="dashboard-section" class="section">
          <h2 class="section-title">Dashboard General</h2>
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-number">🔄</div>
              <div class="stat-label">Usuarios Totales</div>
            </div>
            <div class="stat-card">
              <div class="stat-number">🔄</div>
              <div class="stat-label">Membresías Activas</div>
            </div>
            <div class="stat-card">
              <div class="stat-number">🔄</div>
              <div class="stat-label">Ventas Totales</div>
            </div>
            <div class="stat-card">
              <div class="stat-number">🔄</div>
              <div class="stat-label">Planes Activos</div>
            </div>
            <div class="stat-card">
              <div class="stat-number">🔄</div>
              <div class="stat-label">Personas Registradas al evento</div>
            </div>
            <div class="stat-card">
              <div class="stat-number">🔄</div>
              <div class="stat-label">Personas Registradas a la ruta</div>
            </div>
          </div>
        </div>

        <!-- Users Section -->
        <div id="users-section" class="section hidden">
          <h2 class="section-title">Gestión de Usuarios</h2>
          <input
            type="text"
            class="search-bar"
            placeholder="Buscar usuarios..."
            id="users-search"
          />
          <div class="data-table">
            <div class="table-header">
              <div>Nombre</div>
              <div>Email</div>
              <div>Tipo</div>
              <div>Fecha Registro</div>
              <div>Estado</div>
            </div>
            <div id="users-table-body">
              <!-- Se llenará dinámicamente -->
            </div>
          </div>
        </div>

        <!-- Memberships Section -->
        <div id="memberships-section" class="section hidden">
          <h2 class="section-title">Membresías Activas</h2>
          <input
            type="text"
            class="search-bar"
            placeholder="Buscar membresías..."
            id="memberships-search"
          />
          <div class="data-table">
            <div
              class="table-header"
              style="
                grid-template-columns: 1.5fr 2fr 1.2fr 1fr 1.3fr 1.2fr 1.3fr;
              "
            >
              <div>Usuario</div>
              <div>Email</div>
              <div>Plan</div>
              <div>Precio</div>
              <div>Estado</div>
              <div>Vence</div>
              <div>Acción</div>
            </div>
            <div id="memberships-table-body">
              <!-- Se llenará dinámicamente -->
            </div>
          </div>
        </div>

        <!-- Orders Section -->
        <div id="orders-section" class="section hidden">
          <h2 class="section-title">Pedidos de Tienda</h2>
          <input
            type="text"
            class="search-bar"
            placeholder="Buscar pedidos..."
            id="orders-search"
          />
          <div class="data-table">
            <div
              class="table-header"
              style="
                grid-template-columns: 1.2fr 1.8fr 2.5fr 0.8fr 1.5fr 1fr 1fr 1fr 1fr 1.5fr;
              "
            >
              <div>Usuario</div>
              <div>Email</div>
              <div>Productos</div>
              <div>Total</div>
              <div>Dirección</div>
              <div>Ciudad</div>
              <div>Departamento</div>
              <div>Teléfono</div>
              <div>Método Pago</div>
              <div>Estado</div>
            </div>
            <div id="orders-table-body">
              <!-- Se llenará dinámicamente -->
            </div>
          </div>
        </div>

        <!-- Plans Section -->
        <div id="plans-section" class="section hidden">
          <h2 class="section-title">Planes de Entrenamiento</h2>
          <input
            type="text"
            class="search-bar"
            placeholder="Buscar planes..."
            id="plans-search"
          />
          <div class="data-table">
            <div
              class="table-header"
              style="
                grid-template-columns: 1.5fr 2fr 1.2fr 1fr 1.5fr 1.5fr 1.5fr;
              "
            >
              <div>Usuario</div>
              <div>Email</div>
              <div>Plan</div>
              <div>Precio</div>
              <div>Fecha Finalización</div>
              <div>Entrenador</div>
              <div>Estado</div>
            </div>
            <div id="plans-table-body">
              <!-- Se llenará dinámicamente -->
            </div>
          </div>
        </div>

        <!-- Events Section -->
        <div id="events-section" class="section hidden">
          <h2 class="section-title">Registros de Eventos</h2>
          <input
            type="text"
            class="search-bar"
            placeholder="Buscar eventos..."
            id="events-search"
          />
          <div class="data-table">
            <div
              class="table-header"
              style="grid-template-columns: 1.5fr 2fr 2fr 1.2fr 1.5fr 1.3fr"
            >
              <div>Participante</div>
              <div>Email</div>
              <div>Evento</div>
              <div>Teléfono</div>
              <div>Fecha Evento</div>
              <div>Estado</div>
            </div>
            <div id="events-table-body">
              <!-- Se llenará dinámicamente -->
            </div>
          </div>
        </div>

        <!-- Routes Section -->
        <div id="routes-section" class="section hidden">
          <h2 class="section-title">Registros de Rutas</h2>
          <input
            type="text"
            class="search-bar"
            placeholder="Buscar rutas..."
            id="routes-search"
          />
          <div class="data-table">
            <div
              class="table-header"
              style="
                grid-template-columns: 1.3fr 1.8fr 1.5fr 1.2fr 1.3fr 1.5fr 1fr 0.8fr;
              "
            >
              <div>Participante</div>
              <div>Email</div>
              <div>Ruta</div>
              <div>Teléfono</div>
              <div>Día/Hora</div>
              <div>Ubicación</div>
              <div>Dificultad</div>
              <div>Personas</div>
            </div>
            <div id="routes-table-body">
              <!-- Se llenará dinámicamente -->
            </div>
          </div>
        </div>

        <!-- Contacts Section -->
        <div id="contacts-section" class="section hidden">
          <h2 class="section-title">Mensajes de Contacto</h2>
          <input
            type="text"
            class="search-bar"
            placeholder="Buscar contactos..."
            id="contacts-search"
          />
          <div class="data-table">
            <div
              class="table-header"
              style="grid-template-columns: 1.3fr 2fr 1.5fr 2.5fr 1.2fr 1.3fr"
            >
              <div>Nombre</div>
              <div>Email</div>
              <div>Asunto</div>
              <div>Mensaje</div>
              <div>Fecha</div>
              <div>Estado</div>
            </div>
            <div id="contacts-table-body">
              <!-- Se llenará dinámicamente -->
            </div>
          </div>
        </div>
      </main>
    </div>

    <script>
      // ========================================
      // 🔗 CONFIGURACIÓN DE API PARA DATOS REALES DE NEON
      // ========================================
      const API_BASE_URL = "https://newlifeclub.onrender.com/api/admin";

      // Datos en tiempo real desde la base de datos Neon
      let realData = {
        users: [],
        dashboardStats: {},
      };

      // ========================================
      // 🎨 SISTEMA DE POP-UPS DE CONFIRMACIÓN
      // ========================================
      function showPopup(config) {
        const overlay = document.getElementById("popup-overlay");
        const icon = document.getElementById("popup-icon");
        const title = document.getElementById("popup-title");
        const message = document.getElementById("popup-message");
        const cancelBtn = document.getElementById("popup-cancel");
        const confirmBtn = document.getElementById("popup-confirm");

        // Configurar contenido
        icon.textContent = config.icon || "❓";
        title.textContent = config.title || "Confirmar Acción";
        message.textContent = config.message || "¿Estás seguro?";

        // Configurar botones
        cancelBtn.textContent = config.cancelText || "Cancelar";
        confirmBtn.textContent = config.confirmText || "Confirmar";

        // Configurar clases de botón
        confirmBtn.className = `popup-btn ${config.confirmClass || "confirm"}`;

        // Mostrar popup
        overlay.classList.add("show");

        // Manejar eventos
        const handleCancel = () => {
          hidePopup();
          if (config.onCancel) config.onCancel();
        };

        const handleConfirm = () => {
          hidePopup();
          if (config.onConfirm) config.onConfirm();
        };

        // Limpiar eventos anteriores
        cancelBtn.replaceWith(cancelBtn.cloneNode(true));
        confirmBtn.replaceWith(confirmBtn.cloneNode(true));

        // Obtener referencias nuevas después del clonado
        const newCancelBtn = document.getElementById("popup-cancel");
        const newConfirmBtn = document.getElementById("popup-confirm");

        // Reconfigurar después del clonado
        newCancelBtn.textContent = config.cancelText || "Cancelar";
        newConfirmBtn.textContent = config.confirmText || "Confirmar";
        newConfirmBtn.className = `popup-btn ${
          config.confirmClass || "confirm"
        }`;

        // Agregar eventos
        newCancelBtn.addEventListener("click", handleCancel);
        newConfirmBtn.addEventListener("click", handleConfirm);

        // Cerrar con ESC
        const handleEscape = (e) => {
          if (e.key === "Escape") {
            hidePopup();
            document.removeEventListener("keydown", handleEscape);
          }
        };
        document.addEventListener("keydown", handleEscape);
      }

      function hidePopup() {
        const overlay = document.getElementById("popup-overlay");
        overlay.classList.remove("show");
      }

      // Función para mostrar secciones
      function showSection(sectionName) {
        // Ocultar todas las secciones
        const sections = document.querySelectorAll(".section");
        sections.forEach((section) => section.classList.add("hidden"));

        // Remover clase active de todos los nav items
        const navItems = document.querySelectorAll(".nav-item");
        navItems.forEach((item) => item.classList.remove("active"));

        // Mostrar la sección seleccionada
        document
          .getElementById(sectionName + "-section")
          .classList.remove("hidden");
        document.getElementById("nav-" + sectionName).classList.add("active");

        // Cargar datos de la sección
        loadSectionData(sectionName);
      }

      // ========================================
      // 📊 CARGAR ESTADÍSTICAS DEL DASHBOARD (DATOS REALES)
      // ========================================
      async function loadDashboardStats() {
        try {
          console.log("🔄 Cargando estadísticas del dashboard...");

          // Cargar datos de las APIs que YA FUNCIONAN
          const [
            usersData,
            membershipsData,
            ordersData,
            plansData,
            eventsData,
            routesData,
          ] = await Promise.all([
            fetch(`${API_BASE_URL}/users`).then((r) => r.json()),
            fetch(`${API_BASE_URL}/memberships`).then((r) => r.json()),
            fetch(`${API_BASE_URL}/store-orders`).then((r) => r.json()),
            fetch(`${API_BASE_URL}/training-plans`).then((r) => r.json()),
            fetch(`${API_BASE_URL}/event-registrations`).then((r) => r.json()),
            fetch(`${API_BASE_URL}/route-registrations`).then((r) => r.json()),
          ]);

          // Construir estadísticas a partir de los datos que YA FUNCIONAN
          const stats = {
            totalUsers: usersData.users?.length || 0,
            activeMemberships:
              membershipsData.memberships?.filter((m) => m.status === "activa")
                .length || 0,
            totalSales:
              ordersData.orders?.reduce(
                (sum, order) => sum + parseFloat(order.total || 0),
                0
              ) || 0,
            activeTrainingPlans:
              plansData.plans?.filter((p) => p.status === "activo").length || 0,
            pendingEvents: eventsData.registrations?.length || 0,
            weeklyRoutes: routesData.registrations?.length || 0,
          };

          console.log("✅ Estadísticas cargadas desde APIs existentes:", stats);

          // Actualizar las estadísticas en el dashboard
          updateDashboardUI(stats);
        } catch (error) {
          console.error("❌ Error cargando estadísticas:", error);
          // Mostrar valores por defecto en caso de error
          updateDashboardUI({
            totalUsers: 0,
            activeMemberships: 0,
            totalSales: 0,
            activeTrainingPlans: 0,
            pendingEvents: 0,
            weeklyRoutes: 0,
          });
        }
      }

      // Actualizar interfaz del dashboard
      function updateDashboardUI(stats) {
        const statsGrid = document.querySelector(".stats-grid");
        statsGrid.innerHTML = `
          <div class="stat-card">
            <div class="stat-number">${stats.totalUsers}</div>
            <div class="stat-label">Usuarios Totales</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">${stats.activeMemberships}</div>
            <div class="stat-label">Membresías Activas</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">L.${stats.totalSales.toFixed(2)}</div>
            <div class="stat-label">Ventas Totales</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">${stats.activeTrainingPlans}</div>
            <div class="stat-label">Planes Activos</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">${stats.pendingEvents}</div>
            <div class="stat-label">Personas Registradas al evento</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">${stats.weeklyRoutes}</div>
            <div class="stat-label">Personas Registradas a la ruta</div>
          </div>
        `;
      }

      // ========================================
      // 👥 CARGAR USUARIOS REALES DESDE NEON
      // ========================================
      async function loadUsers() {
        const tableBody = document.getElementById("users-table-body");

        try {
          console.log("🔄 Cargando usuarios reales desde Neon...");
          const response = await fetch(`${API_BASE_URL}/users`);
          const data = await response.json();

          if (!response.ok) {
            throw new Error(data.message || "Error al cargar usuarios");
          }

          console.log("✅ Usuarios cargados:", data);
          realData.users = data.users;

          // Limpiar tabla
          tableBody.innerHTML = "";

          if (data.users.length === 0) {
            tableBody.innerHTML = `
              <div style="padding: 2rem; text-align: center; color: #888; grid-column: 1 / -1;">
                📋 No hay usuarios registrados aún.<br>
                <small>Los usuarios aparecerán aquí cuando se registren en el sitio web.</small>
              </div>
            `;
          } else {
            // Mostrar usuarios reales
            data.users.forEach((user) => {
              const row = document.createElement("div");
              row.className = "table-row";
              row.innerHTML = `
                <div data-label="Nombre:">${user.name}</div>
                <div data-label="Email:">${user.email}</div>
                <div data-label="Tipo:">${user.type}</div>
                <div data-label="Registro:">${user.joinDate}</div>
                <div data-label="Estado:"><span class="status-badge status-active">${user.status}</span></div>
              `;
              tableBody.appendChild(row);
            });
          }
        } catch (error) {
          console.error("❌ Error cargando usuarios:", error);
          tableBody.innerHTML = `
            <div style="padding: 2rem; text-align: center; color: #ef4444; grid-column: 1 / -1;">
              ❌ Error al cargar usuarios: ${error.message}<br>
              <small>Verifica la conexión con la base de datos.</small>
            </div>
          `;
        }
      }

      // ========================================
      // 💪 CARGAR MEMBRESÍAS REALES DESDE NEON
      // ========================================
      async function loadMemberships() {
        const tableBody = document.getElementById("memberships-table-body");

        try {
          console.log("🔄 Cargando membresías reales desde Neon...");
          const response = await fetch(`${API_BASE_URL}/memberships`);
          const data = await response.json();

          if (!response.ok) {
            throw new Error(data.message || "Error al cargar membresías");
          }

          console.log("✅ Membresías cargadas:", data);

          // Limpiar tabla
          tableBody.innerHTML = "";

          if (data.memberships.length === 0) {
            tableBody.innerHTML = `
              <div style="padding: 2rem; text-align: center; color: #888; grid-column: 1 / -1;">
                📋 No hay membresías registradas aún.<br>
                <small>Las membresías aparecerán aquí cuando los usuarios las compren.</small>
              </div>
            `;
          } else {
            // Mostrar membresías reales
            data.memberships.forEach((membership) => {
              const row = document.createElement("div");
              row.className = "table-row";

              const statusClass =
                membership.status === "activa"
                  ? "status-active"
                  : "status-expired";
              const statusText =
                membership.status === "activa" ? "Activa" : "Inactiva";

              row.style.gridTemplateColumns =
                "1.5fr 2fr 1.2fr 1fr 1.3fr 1.2fr 1.3fr";
              row.innerHTML = `
                <div data-label="Usuario:">${membership.user}</div>
                <div data-label="Email:">${membership.email}</div>
                <div data-label="Plan:">${membership.plan}</div>
                <div data-label="Precio:" style="font-weight: 600; color: #4CAF50;">L.${parseFloat(
                  membership.price || 0
                ).toFixed(2)}</div>
                <div data-label="Estado:"><span class="status-badge ${statusClass}">${statusText}</span></div>
                <div data-label="Vence:">${membership.expiresAt}</div>
                <div data-label="Acción:">
                  <button
                    onclick="toggleMembership(${membership.id}, '${
                membership.status === "activa" ? "deactivate" : "activate"
              }')"
                    class="toggle-btn ${
                      membership.status === "activa" ? "deactivate" : "activate"
                    }"
                  >
                    ${
                      membership.status === "activa"
                        ? "❌ Desactivar"
                        : "✅ Activar"
                    }
                  </button>
                </div>
              `;
              tableBody.appendChild(row);
            });
          }
        } catch (error) {
          console.error("❌ Error cargando membresías:", error);
          tableBody.innerHTML = `
            <div style="padding: 2rem; text-align: center; color: #ef4444; grid-column: 1 / -1;">
              ❌ Error al cargar membresías: ${error.message}<br>
              <small>Verifica la conexión con la base de datos.</small>
            </div>
          `;
        }
      }

      // ========================================
      // 🛒 CARGAR PEDIDOS DE TIENDA REALES DESDE NEON
      // ========================================
      async function loadStoreOrders() {
        const tableBody = document.getElementById("orders-table-body");

        try {
          console.log("🛒 Cargando pedidos de tienda reales desde Neon...");
          const response = await fetch(`${API_BASE_URL}/store-orders`);
          const data = await response.json();

          if (!response.ok) {
            throw new Error(data.message || "Error al cargar pedidos");
          }

          console.log("✅ Pedidos cargados:", data);

          // Limpiar tabla
          tableBody.innerHTML = "";

          if (data.orders.length === 0) {
            tableBody.innerHTML = `
              <div style="padding: 2rem; text-align: center; color: #888; grid-column: 1 / -1;">
                📋 No hay pedidos de tienda registrados aún.<br>
                <small>Los pedidos aparecerán aquí cuando los usuarios compren productos físicos.</small>
              </div>
            `;
          } else {
            // Mostrar pedidos reales
            data.orders.forEach((order) => {
              const row = document.createElement("div");
              row.className = "table-row orders-row";

              const statusClass =
                order.status === "entregado"
                  ? "status-active"
                  : "status-pending";
              const statusText =
                order.status === "entregado" ? "Entregado" : "Pendiente";

              row.innerHTML = `
                <div data-label="Usuario:">${order.user}</div>
                <div data-label="Email:">${order.email}</div>
                <div data-label="Productos:" class="products-cell">${
                  order.productos
                }</div>
                <div data-label="Total:">L.${parseFloat(order.total).toFixed(
                  2
                )}</div>
                <div data-label="Dirección:" title="${order.direccion}">${
                order.direccion.length > 20
                  ? order.direccion.substring(0, 20) + "..."
                  : order.direccion
              }</div>
                <div data-label="Ciudad:">${order.ciudad}</div>
                <div data-label="Depto:">${order.departamento}</div>
                <div data-label="Teléfono:">${order.telefono}</div>
                <div data-label="Pago:">${order.metodo_pago}</div>
                <div data-label="Estado:" style="display: flex; flex-direction: column; gap: 0.5rem; align-items: center;">
                  <span class="status-badge ${statusClass}">${statusText}</span>
                  <select
                    onchange="handleStatusChange(this, ${order.id})"
                    class="status-dropdown"
                    style="
                      background: rgba(255,255,255,0.1);
                      color: white;
                      border: 1px solid rgba(255,255,255,0.2);
                      border-radius: 6px;
                      padding: 0.25rem 0.5rem;
                      font-size: 0.8rem;
                      cursor: pointer;
                    "
                  >
                    <option value="">Cambiar estado...</option>
                    <option value="deliver" ${
                      order.status === "entregado" ? "style='display:none'" : ""
                    }>✅ Marcar como Entregado</option>
                    <option value="pending" ${
                      order.status === "pendiente" ? "style='display:none'" : ""
                    }>⏳ Marcar como Pendiente</option>
                  </select>
                </div>
              `;
              tableBody.appendChild(row);
            });
          }
        } catch (error) {
          console.error("❌ Error cargando pedidos:", error);
          tableBody.innerHTML = `
            <div style="padding: 2rem; text-align: center; color: #ef4444; grid-column: 1 / -1;">
              ❌ Error al cargar pedidos: ${error.message}<br>
              <small>Verifica la conexión con la base de datos.</small>
            </div>
          `;
        }
      }

      // ========================================
      // 🎨 MANEJAR CAMBIO DE ESTADO CON DROPDOWN
      // ========================================
      function handleStatusChange(selectElement, orderId) {
        const action = selectElement.value;
        if (action) {
          toggleStoreOrder(orderId, action);
          // Resetear el dropdown
          selectElement.value = "";
        }
      }

      // ========================================
      // 🔄 MARCAR PEDIDO COMO ENTREGADO/PENDIENTE
      // ========================================
      async function toggleStoreOrder(id, action) {
        const actionText =
          action === "deliver"
            ? "marcar como entregado"
            : "marcar como pendiente";

        showPopup({
          icon: action === "deliver" ? "📦" : "⏳",
          title:
            action === "deliver"
              ? "Marcar como Entregado"
              : "Marcar como Pendiente",
          message: `¿Estás seguro de que quieres ${actionText} este pedido?`,
          confirmText:
            action === "deliver" ? "Marcar Entregado" : "Marcar Pendiente",
          confirmClass: "confirm",
          onConfirm: async () => {
            try {
              const response = await fetch(
                `${API_BASE_URL}/store-orders/${id}/toggle`,
                {
                  method: "PUT",
                  headers: {
                    "Content-Type": "application/json",
                  },
                  body: JSON.stringify({ action: action }),
                }
              );

              const data = await response.json();

              if (!response.ok) {
                throw new Error(
                  data.message || `Error al ${actionText} pedido`
                );
              }

              console.log(`✅ Pedido ${actionText}:`, data);

              // Recargar pedidos para mostrar el cambio
              loadStoreOrders();

              // Mostrar mensaje de éxito con pop-up
              showPopup({
                icon: "✅",
                title: "Éxito",
                message: `Pedido ${actionText} exitosamente`,
                confirmText: "Entendido",
                onConfirm: () => {},
              });
            } catch (error) {
              console.error(
                `❌ Error al ${
                  action === "deliver" ? "entregar" : "marcar como pendiente"
                } pedido:`,
                error
              );
              showPopup({
                icon: "❌",
                title: "Error",
                message: `Error: ${error.message}`,
                confirmText: "Entendido",
                confirmClass: "danger",
                onConfirm: () => {},
              });
            }
          },
        });
      }

      // ========================================
      // 🔄 ACTIVAR/DESACTIVAR MEMBRESÍA
      // ========================================
      // 🔄 ACTIVAR/DESACTIVAR MEMBRESÍA (CON POPUPS BONITOS)
      // ========================================
      async function toggleMembership(id, action) {
        const actionText = action === "activate" ? "activar" : "desactivar";
        const statusIcon = action === "activate" ? "💪" : "⏸️";
        const statusTitle =
          action === "activate" ? "Activar Membresía" : "Desactivar Membresía";

        // Mostrar popup de confirmación bonito
        showPopup({
          icon: statusIcon,
          title: statusTitle,
          message: `¿Estás seguro de que quieres ${actionText} esta membresía?`,
          confirmText: actionText.charAt(0).toUpperCase() + actionText.slice(1),
          confirmClass: action === "activate" ? "confirm" : "danger",
          onConfirm: async () => {
            try {
              const response = await fetch(
                `${API_BASE_URL}/memberships/${id}/toggle`,
                {
                  method: "PUT",
                  headers: {
                    "Content-Type": "application/json",
                  },
                  body: JSON.stringify({ action: action }),
                }
              );

              const data = await response.json();

              if (!response.ok) {
                throw new Error(
                  data.message || `Error al ${actionText} membresía`
                );
              }

              console.log(`✅ Membresía ${actionText}da:`, data);

              // Recargar membresías para mostrar el cambio
              loadMemberships();

              // Mostrar mensaje de éxito con popup bonito
              showPopup({
                icon: "🎉",
                title: "Membresía Actualizada",
                message: `Membresía ${actionText}da exitosamente`,
                confirmText: "Entendido",
                onConfirm: () => {},
              });
            } catch (error) {
              console.error(
                `❌ Error al ${
                  action === "activate" ? "activar" : "desactivar"
                } membresía:`,
                error
              );

              // Mostrar error con popup bonito
              showPopup({
                icon: "❌",
                title: "Error",
                message: `Error: ${error.message}`,
                confirmText: "Entendido",
                confirmClass: "danger",
                onConfirm: () => {},
              });
            }
          },
          onCancel: () => {
            // Recargar para revertir el cambio visual del dropdown
            loadMemberships();
          },
        });
      }

      // ========================================
      // 🏃‍♂️ CARGAR PLANES DE ENTRENAMIENTO REALES
      // ========================================
      async function loadTrainingPlans() {
        const tableBody = document.getElementById("plans-table-body");

        try {
          console.log("🔄 Cargando planes de entrenamiento reales...");
          const response = await fetch(`${API_BASE_URL}/training-plans`);
          const data = await response.json();

          if (!response.ok) {
            throw new Error(data.message || "Error al cargar planes");
          }

          console.log("✅ Planes cargados:", data);

          if (data.plans.length === 0) {
            tableBody.innerHTML = `
              <div style="padding: 2rem; text-align: center; color: #888; grid-column: 1 / -1;">
                📋 No hay planes de entrenamiento registrados
              </div>
            `;
            return;
          }

          // Obtener entrenadores guardados del localStorage
          const savedTrainers = JSON.parse(
            localStorage.getItem("training_plan_trainers") || "{}"
          );

          // Generar filas de la tabla
          tableBody.innerHTML = data.plans
            .map((plan) => {
              // Usar entrenador guardado o "Sin asignar" por defecto
              const currentTrainer = savedTrainers[plan.id] || "Sin asignar";

              return `
            <div class="table-row" style="grid-template-columns: 1.5fr 2fr 1.2fr 1fr 1.5fr 1.5fr 1.5fr; min-height: 80px; align-items: center;">
              <div data-label="Usuario:" style="font-weight: 500;">${
                plan.user
              }</div>
              <div data-label="Email:" style="color: #666;">${plan.email}</div>
              <div data-label="Plan:" style="font-weight: 600; color: #2196F3;">${
                plan.plan
              }</div>
              <div data-label="Precio:" style="font-weight: 600; color: #4CAF50;">L.${plan.price.toFixed(
                2
              )}</div>
              <div data-label="Termina:" style="color: #FF9800;">${
                plan.endDate
              }</div>
              <div data-label="Entrenador:">
                <select
                  onchange="updateTrainer(${plan.id}, this.value)"
                  style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: white;"
                >
                  <option value="Sin asignar" ${
                    currentTrainer === "Sin asignar" ? "selected" : ""
                  }>Sin asignar</option>
                  <option value="Coach María" ${
                    currentTrainer === "Coach María" ? "selected" : ""
                  }>Coach María</option>
                  <option value="Coach Carlos" ${
                    currentTrainer === "Coach Carlos" ? "selected" : ""
                  }>Coach Carlos</option>
                  <option value="Coach Ana" ${
                    currentTrainer === "Coach Ana" ? "selected" : ""
                  }>Coach Ana</option>
                </select>
              </div>
              <div data-label="Estado:">
                <select
                  onchange="toggleTrainingPlan(${plan.id}, this.value)"
                  style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;
                         background: ${
                           plan.status === "activo" ? "#E8F5E8" : "#FFF3E0"
                         };
                         color: ${
                           plan.status === "activo" ? "#2E7D32" : "#F57C00"
                         }; font-weight: 600;"
                >
                  <option value="activate" ${
                    plan.status === "activo" ? "selected" : ""
                  }>✅ Activo</option>
                  <option value="deactivate" ${
                    plan.status === "inactivo" ? "selected" : ""
                  }>⏸️ Inactivo</option>
                </select>
              </div>
            </div>
          `;
            })
            .join("");
        } catch (error) {
          console.error("❌ Error cargando planes de entrenamiento:", error);
          tableBody.innerHTML = `
            <div style="padding: 2rem; text-align: center; color: #f44336; grid-column: 1 / -1;">
              ❌ Error al cargar planes: ${error.message}
            </div>
          `;
        }
      }

      // ========================================
      // 🔄 ACTIVAR/DESACTIVAR PLAN DE ENTRENAMIENTO
      // ========================================
      async function toggleTrainingPlan(id, action) {
        const actionText = action === "activate" ? "activar" : "desactivar";
        const statusIcon = action === "activate" ? "✅" : "❌";
        const statusTitle =
          action === "activate" ? "Activar Plan" : "Desactivar Plan";

        // Mostrar popup de confirmación bonito
        showPopup({
          icon: statusIcon,
          title: statusTitle,
          message: `¿Estás seguro de que quieres ${actionText} este plan de entrenamiento?`,
          confirmText: actionText.charAt(0).toUpperCase() + actionText.slice(1),
          confirmClass: action === "activate" ? "confirm" : "danger",
          onConfirm: async () => {
            try {
              const response = await fetch(
                `${API_BASE_URL}/training-plans/${id}/toggle`,
                {
                  method: "PUT",
                  headers: {
                    "Content-Type": "application/json",
                  },
                  body: JSON.stringify({ action: action }),
                }
              );

              const data = await response.json();

              if (!response.ok) {
                throw new Error(data.message || `Error al ${actionText} plan`);
              }

              console.log(`✅ Plan ${actionText}:`, data);

              // Recargar planes para mostrar el cambio
              loadTrainingPlans();

              // Mostrar mensaje de éxito con popup bonito
              showPopup({
                icon: "🎉",
                title: "Plan Actualizado",
                message: `Plan ${actionText} exitosamente`,
                confirmText: "Entendido",
                onConfirm: () => {},
              });
            } catch (error) {
              console.error(
                `❌ Error al ${
                  action === "activate" ? "activar" : "desactivar"
                } plan:`,
                error
              );

              // Mostrar error con popup bonito
              showPopup({
                icon: "❌",
                title: "Error",
                message: `Error: ${error.message}`,
                confirmText: "Entendido",
                confirmClass: "danger",
                onConfirm: () => {},
              });

              // Recargar para revertir el cambio visual
              loadTrainingPlans();
            }
          },
          onCancel: () => {
            // Recargar para revertir el cambio visual del dropdown
            loadTrainingPlans();
          },
        });
      }

      // ========================================
      // 👨‍🏫 ACTUALIZAR ENTRENADOR ASIGNADO (GUARDADO EN LOCALSTORAGE)
      // ========================================
      function updateTrainer(planId, newTrainer) {
        try {
          console.log(
            `🔄 Guardando entrenador para plan ${planId}: ${newTrainer}`
          );

          // Guardar en localStorage
          const trainersKey = "training_plan_trainers";
          let savedTrainers = JSON.parse(
            localStorage.getItem(trainersKey) || "{}"
          );
          savedTrainers[planId] = newTrainer;
          localStorage.setItem(trainersKey, JSON.stringify(savedTrainers));

          console.log(`✅ Entrenador guardado: ${newTrainer}`);

          // Mostrar confirmación con pop-up
          showPopup({
            icon: "👨‍🏫",
            title: "Entrenador Asignado",
            message: `Entrenador "${newTrainer}" asignado exitosamente al plan`,
            confirmText: "Entendido",
            onConfirm: () => {},
          });
        } catch (error) {
          console.error("❌ Error guardando entrenador:", error);
          showPopup({
            icon: "❌",
            title: "Error",
            message: `Error al asignar entrenador: ${error.message}`,
            confirmText: "Entendido",
            confirmClass: "danger",
            onConfirm: () => {},
          });
        }
      }

      // ========================================
      // 🎪 CARGAR REGISTROS DE EVENTOS REALES
      // ========================================
      async function loadEventRegistrations() {
        const tableBody = document.getElementById("events-table-body");

        try {
          console.log("🔄 Cargando registros de eventos reales...");
          const response = await fetch(`${API_BASE_URL}/event-registrations`);
          const data = await response.json();

          if (!response.ok) {
            throw new Error(data.message || "Error al cargar eventos");
          }

          console.log("✅ Registros de eventos cargados:", data);

          if (data.registrations.length === 0) {
            tableBody.innerHTML = `
              <div style="padding: 2rem; text-align: center; color: #888; grid-column: 1 / -1;">
                🎪 No hay registros de eventos
              </div>
            `;
            return;
          }

          // Generar filas de la tabla
          tableBody.innerHTML = data.registrations
            .map(
              (registration) => `
            <div class="table-row" style="grid-template-columns: 1.5fr 2fr 2fr 1.2fr 1.5fr 1.3fr; min-height: 80px; align-items: center;">
              <div data-label="Participante:" style="font-weight: 500;">${
                registration.participant
              }</div>
              <div data-label="Email:" style="color: #666;">${
                registration.email
              }</div>
              <div data-label="Evento:" style="font-weight: 600; color: #2196F3;">${
                registration.event
              }</div>
              <div data-label="Teléfono:" style="color: #FF9800;">${
                registration.phone
              }</div>
              <div data-label="Fecha:" style="color: #4CAF50; font-weight: 500;">${
                registration.eventDate
              }</div>
              <div data-label="Estado:">
                <select
                  onchange="toggleEventParticipation(${
                    registration.id
                  }, this.value)"
                  style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;
                         background: ${
                           registration.status === "registrado"
                             ? "#E3F2FD"
                             : "#E8F5E8"
                         };
                         color: ${
                           registration.status === "registrado"
                             ? "#1976D2"
                             : "#2E7D32"
                         }; font-weight: 600;"
                >
                  <option value="register" ${
                    registration.status === "registrado" ? "selected" : ""
                  }>📝 Registrado</option>
                  <option value="participate" ${
                    registration.status === "participó" ? "selected" : ""
                  }>✅ Participó</option>
                </select>
              </div>
            </div>
          `
            )
            .join("");
        } catch (error) {
          console.error("❌ Error cargando registros de eventos:", error);
          tableBody.innerHTML = `
            <div style="padding: 2rem; text-align: center; color: #f44336; grid-column: 1 / -1;">
              ❌ Error al cargar eventos: ${error.message}
            </div>
          `;
        }
      }

      // ========================================
      // 🔄 MARCAR PARTICIPACIÓN EN EVENTO (SIN POPUPS - DIRECTO)
      // ========================================
      async function toggleEventParticipation(id, action) {
        try {
          console.log(`🔄 Cambiando estado del evento ${id} a:`, action);

          const response = await fetch(
            `${API_BASE_URL}/event-registrations/${id}/toggle`,
            {
              method: "PUT",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ action: action }),
            }
          );

          const data = await response.json();

          if (!response.ok) {
            throw new Error(
              data.message || `Error al cambiar estado del evento`
            );
          }

          console.log(`✅ Estado del evento cambiado exitosamente:`, data);

          // Recargar eventos para mostrar el cambio
          loadEventRegistrations();
        } catch (error) {
          console.error(`❌ Error al cambiar estado del evento:`, error);

          // Recargar para revertir el cambio visual
          loadEventRegistrations();
        }
      }

      // ========================================
      // 🗺️ CARGAR REGISTROS DE RUTAS REALES
      // ========================================
      async function loadRouteRegistrations() {
        const tableBody = document.getElementById("routes-table-body");

        try {
          console.log("🔄 Cargando registros de rutas reales...");
          const response = await fetch(`${API_BASE_URL}/route-registrations`);
          const data = await response.json();

          if (!response.ok) {
            throw new Error(data.message || "Error al cargar rutas");
          }

          console.log("✅ Registros de rutas cargados:", data);

          if (data.registrations.length === 0) {
            tableBody.innerHTML = `
              <div style="padding: 2rem; text-align: center; color: #888; grid-column: 1 / -1;">
                🗺️ No hay registros de rutas
              </div>
            `;
            return;
          }

          // 🛡️ FILTRAR DUPLICADOS PARA MOSTRAR SOLO ÚNICOS
          const uniqueRegistrations = [];
          const seen = new Set();

          data.registrations.forEach((registration) => {
            // Crear clave única: email + ruta
            const uniqueKey = `${registration.email.toLowerCase()}_${registration.route.toLowerCase()}`;

            if (!seen.has(uniqueKey)) {
              seen.add(uniqueKey);
              uniqueRegistrations.push(registration);
            }
          });

          console.log(
            `🔄 Total registros: ${data.registrations.length}, Únicos: ${uniqueRegistrations.length}`
          );

          // Generar filas de la tabla (SOLO ÚNICOS)
          tableBody.innerHTML = uniqueRegistrations
            .map(
              (registration) => `
            <div class="table-row" style="grid-template-columns: 1.3fr 1.8fr 1.5fr 1.2fr 1.3fr 1.5fr 1fr 0.8fr; min-height: 80px; align-items: center;">
              <div data-label="Participante:" style="font-weight: 500;">${
                registration.participant
              }</div>
              <div data-label="Email:" style="color: #666;">${
                registration.email
              }</div>
              <div data-label="Ruta:" style="font-weight: 600; color: #2196F3;">${
                registration.route
              }</div>
              <div data-label="Teléfono:" style="color: #FF9800;">${
                registration.phone
              }</div>
              <div data-label="Día/Hora:" style="color: #4CAF50; font-weight: 500;">${
                registration.dayTime
              }</div>
              <div data-label="Ubicación:" style="color: #9C27B0; font-size: 0.9em;">${
                registration.location
              }</div>
              <div data-label="Dificultad:">
                <span style="padding: 4px 8px; border-radius: 12px; font-size: 0.8em; font-weight: 600;
                             background: ${getDifficultyColor(
                               registration.difficulty
                             )};
                             color: white;">
                  ${registration.difficulty}
                </span>
              </div>
              <div data-label="Personas:" style="text-align: center; font-weight: 600; color: #FF5722;">
                ${registration.participants}
              </div>
            </div>
          `
            )
            .join("");
        } catch (error) {
          console.error("❌ Error cargando registros de rutas:", error);
          tableBody.innerHTML = `
            <div style="padding: 2rem; text-align: center; color: #f44336; grid-column: 1 / -1;">
              ❌ Error al cargar rutas: ${error.message}
            </div>
          `;
        }
      }

      // ========================================
      // 🎨 OBTENER COLOR SEGÚN DIFICULTAD
      // ========================================
      function getDifficultyColor(difficulty) {
        const difficultyLower = difficulty.toLowerCase();
        if (difficultyLower.includes("fácil")) {
          return "#4CAF50"; // Verde
        } else if (difficultyLower.includes("moderado")) {
          return "#FF9800"; // Naranja
        } else if (
          difficultyLower.includes("avanzado") ||
          difficultyLower.includes("difícil")
        ) {
          return "#F44336"; // Rojo
        } else {
          return "#9E9E9E"; // Gris por defecto
        }
      }

      // ========================================
      // 📧 CARGAR MENSAJES DE CONTACTO REALES
      // ========================================
      async function loadContactMessages() {
        const tableBody = document.getElementById("contacts-table-body");

        try {
          console.log("🔄 Cargando mensajes de contacto reales...");
          const response = await fetch(`${API_BASE_URL}/contact-messages`);
          const data = await response.json();

          if (!response.ok) {
            throw new Error(data.message || "Error al cargar contactos");
          }

          console.log("✅ Mensajes de contacto cargados:", data);

          if (data.messages.length === 0) {
            tableBody.innerHTML = `
            <div style="padding: 2rem; text-align: center; color: #888; grid-column: 1 / -1;">
              📧 No hay mensajes de contacto
            </div>
          `;
            return;
          }

          // Obtener estados guardados en localStorage
          const contactStatusKey = "contact_message_status";
          const savedStatus = JSON.parse(
            localStorage.getItem(contactStatusKey) || "{}"
          );

          // Generar filas de la tabla
          tableBody.innerHTML = data.messages
            .map((message) => {
              // Usar estado guardado en localStorage o el por defecto del backend
              const actualStatus = savedStatus[message.id] || message.status;

              return `
          <div class="table-row" style="grid-template-columns: 1.3fr 2fr 1.5fr 2.5fr 1.2fr 1.3fr; min-height: 80px; align-items: center;">
            <div data-label="Nombre:" style="font-weight: 500;">${
              message.name
            }</div>
            <div data-label="Email:" style="color: #666;">${message.email}</div>
            <div data-label="Asunto:" style="font-weight: 600; color: #2196F3;">${
              message.subject
            }</div>
            <div data-label="Mensaje:" style="max-height: 60px; overflow-y: auto; padding: 8px; background: #2c2c2c; border-radius: 4px; font-size: 0.9em; line-height: 1.4; color: #ffffff; border: 1px solid #444;">
              ${
                message.message.length > 100
                  ? message.message.substring(0, 100) + "..."
                  : message.message
              }
            </div>
            <div data-label="Fecha:" style="color: #4CAF50; font-weight: 500;">${
              message.date
            }</div>
            <div data-label="Estado:">
              <select
                onchange="toggleContactStatus(${message.id}, this.value)"
                style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;
                       background: ${
                         actualStatus === "nuevo" ? "#FFF3E0" : "#E8F5E8"
                       };
                       color: ${
                         actualStatus === "nuevo" ? "#F57C00" : "#2E7D32"
                       }; font-weight: 600;"
              >
                <option value="new" ${
                  actualStatus === "nuevo" ? "selected" : ""
                }>📩 Nuevo</option>
                <option value="respond" ${
                  actualStatus === "respondido" ? "selected" : ""
                }>✅ Respondido</option>
              </select>
            </div>
          </div>
        `;
            })
            .join("");
        } catch (error) {
          console.error("❌ Error cargando mensajes de contacto:", error);
          tableBody.innerHTML = `
          <div style="padding: 2rem; text-align: center; color: #f44336; grid-column: 1 / -1;">
            ❌ Error al cargar contactos: ${error.message}
          </div>
        `;
        }
      }

      // ========================================
      // 🔄 MARCAR MENSAJE COMO RESPONDIDO/NUEVO (GUARDADO EN LOCALSTORAGE)
      // ========================================
      async function toggleContactStatus(id, action) {
        try {
          console.log(`🔄 Cambiando estado del mensaje ${id} a:`, action);

          // Guardar estado en localStorage para referencia del admin
          const contactStatusKey = "contact_message_status";
          let savedStatus = JSON.parse(
            localStorage.getItem(contactStatusKey) || "{}"
          );

          const newStatus = action === "respond" ? "respondido" : "nuevo";
          savedStatus[id] = newStatus;
          localStorage.setItem(contactStatusKey, JSON.stringify(savedStatus));

          console.log(
            `✅ Estado guardado localmente: ${newStatus} para mensaje ${id}`
          );

          // Recargar contactos para mostrar el cambio (ahora usará localStorage)
          loadContactMessages();
        } catch (error) {
          console.error(`❌ Error al cambiar estado del mensaje:`, error);

          // Recargar para revertir el cambio visual
          loadContactMessages();
        }
      }

      // Función para cargar datos de cada sección
      function loadSectionData(sectionName) {
        switch (sectionName) {
          case "dashboard":
            loadDashboardStats();
            break;
          case "users":
            loadUsers();
            break;
          case "memberships":
            loadMemberships();
            break;
          case "orders":
            loadStoreOrders();
            break;
          case "plans":
            loadTrainingPlans();
            break;
          case "events":
            loadEventRegistrations();
            break;
          case "routes":
            loadRouteRegistrations();
            break;
          case "contacts":
            loadContactMessages();
            break;
          default:
            // Para otras secciones, mostrar mensaje de "próximamente"
            const tableBody = document.getElementById(
              sectionName + "-table-body"
            );
            if (tableBody) {
              tableBody.innerHTML = `
                <div style="padding: 2rem; text-align: center; color: #888; grid-column: 1 / -1;">
                  🚧 Sección en desarrollo<br>
                  <small>Esta funcionalidad estará disponible pronto.</small>
                </div>
              `;
            }
            break;
        }
      }

      // Función de logout con pop-up
      function logout() {
        showPopup({
          icon: "👋",
          title: "Cerrar Sesión",
          message: "¿Estás seguro de que quieres cerrar sesión?",
          confirmText: "Cerrar Sesión",
          confirmClass: "danger",
          onConfirm: () => {
            // Limpiar sesiones
            localStorage.removeItem("adminSession");
            sessionStorage.removeItem("adminSession");
            window.location.href = "adminlogin.html";
          },
        });
      }

      // Verificar sesión de administrador
      function checkAdminSession() {
        const sessionActive =
          localStorage.getItem("adminSession") ||
          sessionStorage.getItem("adminSession");
        if (!sessionActive) {
          alert("Acceso denegado. Debes iniciar sesión como administrador.");
          window.location.href = "adminlogin.html";
          return false;
        }
        return true;
      }

      // Cargar dashboard por defecto
      document.addEventListener("DOMContentLoaded", function () {
        if (checkAdminSession()) {
          showSection("dashboard");
        }
      });

      // ========================================
      // 🔍 BÚSQUEDA EN TIEMPO REAL PARA USUARIOS
      // ========================================
      document.addEventListener("DOMContentLoaded", function () {
        const searchInput = document.getElementById("users-search");
        if (searchInput) {
          searchInput.addEventListener("input", function (e) {
            const searchTerm = e.target.value.toLowerCase();
            filterUsersTable(searchTerm);
          });
        }

        // 🔍 BÚSQUEDA EN TIEMPO REAL PARA PEDIDOS
        const ordersSearchInput = document.getElementById("orders-search");
        if (ordersSearchInput) {
          ordersSearchInput.addEventListener("input", function (e) {
            const searchTerm = e.target.value.toLowerCase();
            filterOrdersTable(searchTerm);
          });
        }

        // 🔍 BÚSQUEDA EN TIEMPO REAL PARA PLANES
        const plansSearchInput = document.getElementById("plans-search");
        if (plansSearchInput) {
          plansSearchInput.addEventListener("input", function (e) {
            const searchTerm = e.target.value.toLowerCase();
            filterPlansTable(searchTerm);
          });
        }

        // 🔍 BÚSQUEDA EN TIEMPO REAL PARA EVENTOS
        const eventsSearchInput = document.getElementById("events-search");
        if (eventsSearchInput) {
          eventsSearchInput.addEventListener("input", function (e) {
            const searchTerm = e.target.value.toLowerCase();
            filterEventsTable(searchTerm);
          });
        }

        // 🔍 BÚSQUEDA EN TIEMPO REAL PARA RUTAS
        const routesSearchInput = document.getElementById("routes-search");
        if (routesSearchInput) {
          routesSearchInput.addEventListener("input", function (e) {
            const searchTerm = e.target.value.toLowerCase();
            filterRoutesTable(searchTerm);
          });
        }

        // 🔍 BÚSQUEDA EN TIEMPO REAL PARA CONTACTOS
        const contactsSearchInput = document.getElementById("contacts-search");
        if (contactsSearchInput) {
          contactsSearchInput.addEventListener("input", function (e) {
            const searchTerm = e.target.value.toLowerCase();
            filterContactsTable(searchTerm);
          });
        }
      });

      function filterUsersTable(searchTerm) {
        const tableBody = document.getElementById("users-table-body");
        const rows = tableBody.querySelectorAll(".table-row");

        rows.forEach((row) => {
          const text = row.textContent.toLowerCase();
          if (text.includes(searchTerm)) {
            row.style.display = "";
          } else {
            row.style.display = "none";
          }
        });
      }

      function filterOrdersTable(searchTerm) {
        const tableBody = document.getElementById("orders-table-body");
        const rows = tableBody.querySelectorAll(".table-row");

        rows.forEach((row) => {
          const text = row.textContent.toLowerCase();
          if (text.includes(searchTerm)) {
            row.style.display = "";
          } else {
            row.style.display = "none";
          }
        });
      }

      function filterPlansTable(searchTerm) {
        const tableBody = document.getElementById("plans-table-body");
        const rows = tableBody.querySelectorAll(".table-row");

        rows.forEach((row) => {
          const text = row.textContent.toLowerCase();
          if (text.includes(searchTerm)) {
            row.style.display = "";
          } else {
            row.style.display = "none";
          }
        });
      }

      function filterEventsTable(searchTerm) {
        const tableBody = document.getElementById("events-table-body");
        const rows = tableBody.querySelectorAll(".table-row");

        rows.forEach((row) => {
          const text = row.textContent.toLowerCase();
          if (text.includes(searchTerm)) {
            row.style.display = "";
          } else {
            row.style.display = "none";
          }
        });
      }

      function filterRoutesTable(searchTerm) {
        const tableBody = document.getElementById("routes-table-body");
        const rows = tableBody.querySelectorAll(".table-row");

        rows.forEach((row) => {
          const text = row.textContent.toLowerCase();
          if (text.includes(searchTerm)) {
            row.style.display = "";
          } else {
            row.style.display = "none";
          }
        });
      }

      function filterContactsTable(searchTerm) {
        const tableBody = document.getElementById("contacts-table-body");
        const rows = tableBody.querySelectorAll(".table-row");

        rows.forEach((row) => {
          const text = row.textContent.toLowerCase();
          if (text.includes(searchTerm)) {
            row.style.display = "";
          } else {
            row.style.display = "none";
          }
        });
      }

      // ========================================
      // 📱 FUNCIONES DEL MENÚ MÓVIL
      // ========================================
      function toggleMobileMenu() {
        const sidebar = document.querySelector(".sidebar");
        const menuIcon = document.getElementById("menu-icon");

        if (sidebar.classList.contains("mobile-open")) {
          sidebar.classList.remove("mobile-open");
          menuIcon.textContent = "☰";
        } else {
          sidebar.classList.add("mobile-open");
          menuIcon.textContent = "✕";
        }
      }

      // Sobrescribir showSection para cerrar menú móvil
      const originalShowSection = showSection;
      showSection = function (sectionName) {
        // Ejecutar función original
        originalShowSection(sectionName);

        // Cerrar menú móvil
        const sidebar = document.querySelector(".sidebar");
        const menuIcon = document.getElementById("menu-icon");
        if (sidebar.classList.contains("mobile-open")) {
          sidebar.classList.remove("mobile-open");
          menuIcon.textContent = "☰";
        }
      };
    </script>

    <!-- ============================================ -->
    <!-- 🎨 POP-UP DE CONFIRMACIÓN -->
    <!-- ============================================ -->
    <div id="popup-overlay" class="popup-overlay">
      <div class="popup-content">
        <div id="popup-icon" class="popup-icon">❓</div>
        <h3 id="popup-title" class="popup-title">Confirmar Acción</h3>
        <p id="popup-message" class="popup-message">
          ¿Estás seguro de que quieres realizar esta acción?
        </p>
        <div class="popup-buttons">
          <button id="popup-cancel" class="popup-btn cancel">Cancelar</button>
          <button id="popup-confirm" class="popup-btn confirm">
            Confirmar
          </button>
        </div>
      </div>
    </div>
  </body>
</html>
